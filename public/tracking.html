<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Tracking - Mike's Cafe</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f8fafc; padding: 20px; }
        
        .tracking-container {
            max-width: 500px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .status-timeline {
            margin: 30px 0;
            position: relative;
        }
        
        .status-step {
            display: flex;
            align-items: center;
            margin: 20px 0;
            position: relative;
        }
        
        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            z-index: 2;
        }
        
        .status-icon.active {
            background: #10b981;
            color: white;
        }
        
        .status-text {
            text-align: left;
        }
        
        .status-connector {
            position: absolute;
            left: 20px;
            top: 40px;
            bottom: -20px;
            width: 2px;
            background: #e5e7eb;
            z-index: 1;
        }
        
        .status-step:last-child .status-connector {
            display: none;
        }
    </style>
</head>
<body>
    <div class="tracking-container">
        <h1>Order Tracking</h1>
        <p>Track your order in real-time</p>
        
        <div class="order-info">
            <h2 id="orderId">Order #</h2>
            <p id="orderStatus">Status: Loading...</p>
        </div>
        
        <div class="status-timeline" id="statusTimeline">
            <!-- Status steps will be added here -->
        </div>
        
        <button onclick="goBackToMenu()">Back to Menu</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const urlParams = new URLSearchParams(window.location.search);
        const orderId = urlParams.get('order');
        
        if (orderId) {
            document.getElementById('orderId').textContent = `Order ${orderId}`;
            trackOrder(orderId);
        }
        
        function trackOrder(orderId) {
            // Listen for order status updates
            socket.on('order_updated', (data) => {
                if (data.orderId === orderId) {
                    updateOrderStatus(data.status);
                }
            });
            
            // Initial status check
            checkOrderStatus(orderId);
        }
        
        async function checkOrderStatus(orderId) {
            try {
                const response = await fetch('/api/kitchen/orders');
                const data = await response.json();
                
                if (data.success) {
                    const order = data.orders.find(o => o.id === orderId);
                    if (order) {
                        updateOrderStatus(order.status);
                    }
                }
            } catch (error) {
                console.error('Error checking order status:', error);
            }
        }
        
        function updateOrderStatus(status) {
            document.getElementById('orderStatus').textContent = `Status: ${status}`;
            updateStatusTimeline(status);
        }
        
        function updateStatusTimeline(currentStatus) {
            const statuses = [
                { id: 'new', label: 'Order Received', icon: 'ðŸ“¦' },
                { id: 'preparing', label: 'Preparing Food', icon: 'ðŸ‘¨â€ðŸ³' },
                { id: 'ready', label: 'Ready for Pickup', icon: 'âœ…' },
                { id: 'completed', label: 'Order Completed', icon: 'ðŸŽ‰' }
            ];
            
            const timeline = document.getElementById('statusTimeline');
            timeline.innerHTML = '';
            
            statuses.forEach((status, index) => {
                const isActive = statuses.findIndex(s => s.id === currentStatus) >= index;
                const isCurrent = status.id === currentStatus;
                
                const step = document.createElement('div');
                step.className = 'status-step';
                
                step.innerHTML = `
                    <div class="status-icon ${isActive ? 'active' : ''}">
                        ${status.icon}
                    </div>
                    <div class="status-text">
                        <strong>${status.label}</strong>
                        ${isCurrent ? '<br><small>Current Status</small>' : ''}
                    </div>
                    ${index < statuses.length - 1 ? '<div class="status-connector"></div>' : ''}
                `;
                
                timeline.appendChild(step);
            });
        }
        
        function goBackToMenu() {
            window.location.href = '/';
        }
    </script>
</body>
</html>